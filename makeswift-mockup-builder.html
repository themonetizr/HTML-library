<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate your mockup</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
    <style>
        body {
            background: #f8f9fa;
        }
        /* Mobile preview style for Screen 2 */
        #screen2 {
            display:none;
        }
        #reviewPreview{
            max-width: 393px; /* iPhone 15 width */
            height: 852px;    /* iPhone 15 height */
            margin: auto;
            border: 1px solid #ccc;
            border-radius: 16px;
            overflow: hidden;
            position: relative;
            background-size: cover;
            background-position: center;
            background-image: url('https://cdn.monetizr.com/default_assets/mockup_builder_background.png');
        }
        .overlay {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.5);
            padding: 1rem;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }
        .logo {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: auto;
        }
        #screen1 {
            display: block;
        }
        .preview-img {
            max-width: 100%;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .preview-video {
            max-width: 100%;
            border-radius: 8px;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div id="screen1" class="card shadow-sm">
                    <div class="card-body">
                        <h3 class="card-title mb-4">Step 1: Fill in Your Details</h3>
                        <form id="uploadForm" enctype="multipart/form-data">
                            <!-- Logo file-->
                            <div class="mb-3">
                                <label for="imageFile" class="form-label">Logo (JPG/PNG):</label>
                                <input class="form-control" type="file" id="imageFile" name="imageFile" accept=".jpg,.jpeg,.png" required>
                            </div>

                            <!-- MP4 Upload -->
                            <div class="mb-3">
                                <label for="videoFile" class="form-label">Video (MP4):</label>
                                <input class="form-control" type="file" id="videoFile" name="videoFile" accept="video/mp4" required>
                            </div>

                            <!-- Color Pickers -->
                            <div class="mb-3">
                                <label for="brandColor" class="form-label">Brand Color:</label>
                                <input class="form-control" type="color" id="brandColor" name="brandColor" value="#ff0000" required>
                            </div>

                            <div class="mb-3">
                                <label for="textColor" class="form-label">Text Color:</label>
                                <input class="form-control" type="color" id="textColor" name="textColor" value="#00ff00" required>
                            </div>

                            <!-- Text Input -->
                            <div class="mb-3">
                                <label for="brandName" class="form-label">Brand name:</label>
                                <input class="form-control" type="text" id="brandName" name="brandName" placeholder="Enter brand name..." required>
                            </div>

                            <!-- Submit -->
                            <br>
                            <button type="button" id="nextBtn" class="btn btn-primary w-100">Next</button>

                            <div id="message" class="mt-4"></div>
                        </form>
                    </div>
                </div>
                <div id="screen2" class="card shadow-sm mt-4">
                    <div class="card-body">
                        <h3 class="card-title mb-4">Step 2: Review & Confirm</h3>
                        <div id="reviewPreview">
                            <div class="overlay">
                                <div class="text-center mb-3">
                                    <img id="previewLogo" class="logo" src="" alt="Logo">
                                </div>
                                <div id="previewVideo" class="video" style="display:none"></div>
                            </div>
                        </div>
                        <div id="reviewData"></div>
                        <button type="submit" id="submitButton" class="btn btn-primary w-100">Upload</button>
                        <button id="backBtn" class="btn btn-secondary w-100 mt-2">Back</button>
                        <div id="response" class="mt-4"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('uploadForm');
        const screen1 = document.getElementById('screen1');
        const screen2 = document.getElementById('screen2');
        const reviewData = document.getElementById('reviewData');   
        const messageDiv = document.getElementById('message');
        const responseDiv = document.getElementById('response');
        const previewLogo = document.getElementById('previewLogo');
        const previewVideo = document.getElementById('previewVideo');
        
        const imageInput = document.getElementById('imageFile');
        const videoInput = document.getElementById('videoFile');
        const brandColorInput = document.getElementById('brandColor');
        const textColorInput = document.getElementById('textColor');
        const brandNameInput = document.getElementById('brandName');
        const submitButton = document.getElementById('submitButton');
        const nextBtn = document.getElementById('nextBtn');
        const backBtn = document.getElementById('backBtn');
        const cloudFunctionUrl = 'https://mockup-generator-upload-1074977689117.us-central1.run.app';


        nextBtn.addEventListener('click', () => {
            // Validate form inputs
            if (imageInput.files.length === 0) {
                messageDiv.innerHTML = '<div class="alert alert-danger">Please select a logo file.</div>';
                return;
            }

            if (videoInput.files.length === 0) {
                messageDiv.innerHTML = '<div class="alert alert-danger">Please select a video file.</div>';
                return;
            }
        
            if (!brandColorInput.value || !textColorInput.value || !brandNameInput.value) {
                messageDiv.innerHTML = '<div class="alert alert-danger">Please fill in all fields.</div>';
                return;
            }

            // Logo preview
            let logoFile = imageInput.files[0];
            if (logoFile) {
                const reader = new FileReader();
                reader.onload = e => {
                    previewLogo.src = e.target.result;
                };
                reader.readAsDataURL(logoFile);
            }

            // Video preview
            let videoPreviewHTML = '';
            let videoFile = videoInput.files[0];
            if (videoFile) {
                const videoURL = URL.createObjectURL(videoFile);
                videoPreviewHTML = `<video class="preview-video" src="${videoURL}" controls muted loop></video>`;
                previewVideo.innerHTML = videoPreviewHTML;
            }

            // Populate review data
            reviewData.innerHTML = `
            <p><strong>Logo:</strong> ${imageInput.files[0] ? imageInput.files[0].name : 'No file'}</p>
            <p><strong>Video:</strong> ${videoInput.files[0] ? videoInput.files[0].name : 'No file'}</p>
            <p><strong>Brand Color:</strong> <span style="color: ${brandColorInput.value};">${brandColorInput.value}</span></p>
            <p><strong>Text Color:</strong> <span style="color: ${textColorInput.value};">${textColorInput.value}</span></p>
            <p><strong>Brand Name:</strong> ${brandNameInput.value}</p>
            `;

            // Hide screen 1 and show screen 2
            screen1.style.display = 'none';
            screen2.style.display = 'block';
        });

        // Go back to form
        backBtn.addEventListener('click', () => {
            screen2.style.display = 'none';
            screen1.style.display = 'block';
        });

        // Submit to server
        submitButton.addEventListener('click', async (event) => {
            event.preventDefault();

            submitButton.disabled = true;
            submitButton.textContent = 'Submitting...';
            responseDiv.innerHTML = '';

            const formData = new FormData(form);

            responseDiv.innerHTML = '<div class="text-secondary">Submitting...</div>';
            try {
                const response = await fetch(cloudFunctionUrl, {
                    method: 'POST',
                    body: formData,
                });

                const result = await response.json();

                if (response.ok) {
                    // Create a list of clickable links from the returned URLs
                    let urlListHtml = '<h4>âœ… Success! Files sent:</h4><ul>';
                    result.urls.forEach(url => {
                        const fileName = url.split('/').pop();
                        urlListHtml += `<li><a href="${url}" target="_blank">${fileName}</a></li>`;
                    });
                    urlListHtml += '</ul>';
                    responseDiv.innerHTML = urlListHtml;
                } else {
                    responseDiv.innerHTML = `<p class="error">Error: ${result.error}</p>`;
                }

            } catch (error) {
                responseDiv.innerHTML = `<p class="error">A network error occurred: ${error.message}</p>`;
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Upload';
                form.reset();
            }
        });
    </script>
</body>
</html>