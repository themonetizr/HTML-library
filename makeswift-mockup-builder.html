<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate your mockup</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gothic+A1:wght@100;200;300;400;500;600;700;800;900&family=League+Spartan:wght@100..900&display=swap" rel="stylesheet">
    <style>
        body {
            background: #EBF6FF;
            font-family: "Gothic A1", sans-serif;
        }
        /* Mobile preview style for Screen 2 */
        #screen2 {
            display:none;
        }
        #reviewPreview{
            max-width: 314px; /* iPhone 15 width */
            width:314px;
            height: 681px;    /* iPhone 15 height */
            height: 681px;
            margin: auto;
            border: 1px solid #ccc;
            border-radius: 16px;
            overflow: hidden;
            position: relative;
            background-size: cover;
            background-position: center;
            background-image: url('https://cdn.monetizr.com/default_assets/mockup_builder_background_2.png');
        }
        .overlay {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }
        #screen1 {
            display: block;
        }
        .preview-img {
            max-width: 100%;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }
        .previewLogoContainer{
            position: absolute;
            top:130px;
            left:20px;
            width:105px;
            height:160px;
        }
        .logoContainer{
            max-width: 105px;
            width: 105px;
            height: 105px;
            border-radius: 50%;
            overflow: hidden;
            background-color: rgba(255, 255, 255, 0.5);
            background: url('https://cdn.monetizr.com/not/Rotating-star_2.png') no-repeat center center;
        }
        .logo {
            max-width: 100%;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .exclamationSign {
            position: absolute;
            top: 0;
            right: 0;
            width: 35px;
            height: 35px;
            background:url('https://cdn.monetizr.com/default_assets/exclamation_icon.png') no-repeat center center;
            background-size: contain;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .video{
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 681px;
            background-color: #000;
        }
        .preview-video {
            max-width: 100%;
            width: 100%;
            height: 681px;
            object-fit: cover;
        }
        #wonModal {
            --bs-modal-width: 272px;
            --bs-modal-max-width: 272px;
        }
        #reviewPreview .modal{
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        #reviewPreview .modal-dialog{
            width:272px;
            max-width: 272px;
            margin: auto; /* Center inside container */
            max-height: 100%;
        }
        #reviewPreview .modal-content {
            background-color: #4FAFEC;
            position: relative;
            overflow: visible;
            border: 5px solid #FFF;
            border-radius: 25px;
            height: auto;
            max-height: 100%;
        }

        .modal-body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
            overflow-y: auto;
            overflow-x:hidden;
        }
        .modal-header .modal-logo {
            position: absolute;
            top: -65px;
            left: 20px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
        }
        .modal-header {
            border-bottom: none;
            position: relative;
        }
        .modal-header .close {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: white;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #ddd;
            box-shadow: 0px 2px 5px rgba(0,0,0,0.2);
            padding: 0;
        }
        .close span {
            font-size: 35px;
            line-height: 1;
            display:block;
            margin:0;
        }
        .hidden {
            visibility: hidden;
        }
        .modal-logo {
            display: block;
            margin: 0 auto 10px;
            width: 70px;
            height: 70px;
            margin-top:25px;
        }
        .bold-header {
            font-weight: 900;
            font-size: 2.5rem;
            text-align: center;
        }
        .reward-body {
            font-size: 1.2rem;
            text-align: center;
            font-weight: 500;
            margin-bottom:0;
        }
        .reward-image-container{
            width: 100%;
            margin: 0 auto;
            height: 250px;
            position: relative;
        }
        .reward-image-container img {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 100%;
            z-index:2;
        }

        .reward-image-container .background-image {
            z-index: 1;
            max-height: 100%;
            top:0;
            left:0;
            transform-origin: center center;
        }
        .reward-image-container .foreground-image {
            max-width: 120px;
        }
        #getRewardsVideo {
            width: 100px;
            height: 30px;
            margin-top: -20px;
            cursor: pointer;
        }
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(23, 235, 73, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }

        .btn-animated {
            animation: pulse 1.5s infinite;
        }
        .claimRewardBtn {
            width: 150px;
            height: 45px;
            cursor: pointer;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to   { transform: rotate(360deg); }
        }

        .spin {
            transform-origin: center center;
            animation: spin 7s linear infinite;
        }
        .reward-button{
            margin-top: -20px;
        }
        @keyframes pulseexclamation {
            0% { transform: scale(1.0); box-shadow: 0 0 0 0 rgba(23, 235, 73, 0); }
            70% { transform: scale(1.3); box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
            100% { transform: scale(1.0); box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }

        .exclamation-animated {
            animation: pulseexclamation 3.0s infinite;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div id="screen1" class="card shadow-sm">
                    <div class="card-body">
                        <h3 class="card-title mb-4">Step 1: Upload (campaign assets)</h3>
                        <form id="uploadForm" enctype="multipart/form-data">
                            <!-- Logo file-->
                            <div class="mb-3">
                                <label for="imageFile" class="form-label">Logo (JPG/PNG):</label>
                                <input class="form-control" type="file" id="imageFile" name="imageFile" accept=".jpg,.jpeg,.png" required>
                            </div>

                            <!-- MP4 Upload -->
                            <div class="mb-3">
                                <label for="videoFile" class="form-label">Video (MP4):</label>
                                <input class="form-control" type="file" id="videoFile" name="videoFile" accept="video/mp4" required>
                            </div>

                            <!-- Color Pickers -->
                            <div class="mb-3">
                                <label for="brandColor" class="form-label">Brand color:</label>
                                <input class="form-control" type="color" id="brandColor" name="brandColor" value="#0033A1" required>
                            </div>

                            <div class="mb-3">
                                <label for="textColor" class="form-label">Text color:</label>
                                <input class="form-control" type="color" id="textColor" name="textColor" value="#FFFFFF" required>
                            </div>

                            <!-- Text Input -->
                            <div class="mb-3">
                                <label for="brandName" class="form-label">Brand name:</label>
                                <input class="form-control" type="text" id="brandName" name="brandName" placeholder="Enter brand name..." required>
                            </div>

                            <!-- Email Input -->
                            <div class="mb-3">
                                <label for="contactEmail" class="form-label">Contact email:</label>
                                <input class="form-control" type="email" id="contactEmail" name="contactEmail" placeholder="Enter contact email..." required>
                            </div>

                            <!-- Submit -->
                            <br>
                            <button type="button" id="nextBtn" class="btn btn-primary w-100">Next</button>

                            <div id="message" class="mt-4"></div>
                        </form>
                    </div>
                </div>
                <div id="screen2" class="card shadow-sm mt-4">
                    <div class="card-body">
                        <h3 class="card-title mb-4">Step 2: Preview</h3>
                        <div id="reviewPreview">
                            <div class="overlay">
                                <div class="text-center mb-3 previewLogoContainer">
                                    <div class="logoContainer">
                                        <div class="exclamationSign exclamation-animated"></div>
                                        <img id="previewLogo" class="logo" src="" alt="Logo">
                                    </div>
                                    <img id="getRewardsVideo" src="https://cdn.monetizr.com/not/Teaser-button.png" class="btn-animated" />
                                </div>
                                <div id="previewVideo" class="video" style="display:none"></div>
                            </div>
                            <div class="modal fade" id="wonModal" tabindex="-1">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content" id="brandColorOutput">
                                        <div class="modal-header">
                                            <img id="modalHeaderLogo" src="" alt="Logo" class="modal-logo">
                                            <button type="button" id="closeModal" class="close" data-dismiss="modal" aria-label="Close" style="position:absolute; top:-18px; right: -10px;">
                                                <img src="https://cdn.monetizr.com/not/close.png" alt="Close" style="width:40px; height:40px;">
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <h1 class="bold-header mb-2 mt-4">Congrats!</h1>
                                            <p class="reward-body">You get a reward from <br/> <b style="font-weight: 800;" id="brandNameOutput"></b></p>
                                            <div class="reward-image-container">
                                                <img src="https://cdn.monetizr.com/not/Rotating-star_2.png" class="background-image spin" alt="star">
                                                <img src="https://cdn.monetizr.com/not/mockup_pulsing_reward.png" class="foreground-image" alt="Logo">
                                            </div>
                                            <div class="reward-button mb-2">
                                                <img src="https://storage.googleapis.com/middleware-media-files/not/Reward-button.png" class="claimRewardBtn btn-animated" data-dismiss="modal" id="claimReward" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="reviewData"></div>
                        <div id="response" class="mt-4" style="width: 480px;"></div>
                            <button type="submit" id="submitButton" class="btn btn-primary w-100 mt-2">Submit campaign</button>
                            <button id="backBtn" class="btn btn-secondary w-100 mt-2">Back</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('uploadForm');
        const screen1 = document.getElementById('screen1');
        const screen2 = document.getElementById('screen2');
        const reviewData = document.getElementById('reviewData');   
        const messageDiv = document.getElementById('message');
        const responseDiv = document.getElementById('response');
        const previewLogo = document.getElementById('previewLogo');
        const previewVideo = document.getElementById('previewVideo');
        const modalHeaderLogo = document.getElementById('modalHeaderLogo');
        const closeModalBtn = document.getElementById('closeModal');
        const claimRewardBtn = document.getElementById('claimReward');
        let previewVideoEl;
        
        const imageInput = document.getElementById('imageFile');
        const videoInput = document.getElementById('videoFile');
        const brandColorInput = document.getElementById('brandColor');
        const textColorInput = document.getElementById('textColor');
        const brandNameInput = document.getElementById('brandName');
        const contactEmailInput = document.getElementById('contactEmail');
        const submitButton = document.getElementById('submitButton');
        const nextBtn = document.getElementById('nextBtn');
        const backBtn = document.getElementById('backBtn');
        const cloudFunctionUrl = 'https://mockup-generator-upload-1074977689117.us-central1.run.app';
        let brandNameOutput = document.getElementById('brandNameOutput');
        let brandColorOutput = document.getElementById('brandColorOutput');
        let brandColor = '';
        let textColor = '';

        nextBtn.addEventListener('click', () => {
            // Validate form inputs
            if (imageInput.files.length === 0) {
                messageDiv.innerHTML = '<div class="alert alert-danger">Please select a logo file.</div>';
                return;
            }

            if (videoInput.files.length === 0) {
                messageDiv.innerHTML = '<div class="alert alert-danger">Please select a video file.</div>';
                return;
            }
        
            if (!brandColorInput.value || !textColorInput.value || !brandNameInput.value || !contactEmailInput.value) {
                messageDiv.innerHTML = '<div class="alert alert-danger">Please fill in all fields.</div>';
                return;
            }

            // Logo preview
            let logoFile = imageInput.files[0];
            if (logoFile) {
                const reader = new FileReader();
                reader.onload = e => {
                    previewLogo.src = e.target.result;
                    modalHeaderLogo.src = e.target.result; // Set logo in modal header
                };
                reader.readAsDataURL(logoFile);
            }

            // Video preview
            let videoPreviewHTML = '';
            let videoFile = videoInput.files[0];
            if (videoFile) {
                const videoURL = URL.createObjectURL(videoFile);
                videoPreviewHTML = `<video class="preview-video" id="videoElement" src="${videoURL}" controls muted></video>`;
                previewVideo.innerHTML = videoPreviewHTML;
            }

            previewVideoEl = document.getElementById('videoElement');
            if (previewVideoEl) {
                previewVideoEl.muted = true;  // Default muted
                previewVideoEl.autoplay = true;
            }

            // Populate review data
            brandNameOutput.textContent = brandNameInput.value;
            brandColor = brandColorInput.value;
            textColor = textColorInput.value;
            brandColorOutput.style.backgroundColor = brandColor;
            brandColorOutput.style.color = textColor;
            reviewData.innerHTML = `
            <p><strong>Logo:</strong> ${imageInput.files[0] ? imageInput.files[0].name : 'No file'}</p>
            <p><strong>Video:</strong> ${videoInput.files[0] ? videoInput.files[0].name : 'No file'}</p>
            <p><strong>Brand color:</strong> <span style="color: ${brandColor};">${brandColor}</span></p>
            <p><strong>Text color:</strong> <span style="color: ${textColor};">${textColor}</span></p>
            <p><strong>Brand Name:</strong> ${brandNameInput.value}</p>
            <p><strong>Contact Email:</strong> ${contactEmailInput.value}</p>
            `;

            // Hide screen 1 and show screen 2
            screen1.style.display = 'none';
            screen2.style.display = 'block';

        });

        // Go back to form
        backBtn.addEventListener('click', () => {
            screen2.style.display = 'none';
            screen1.style.display = 'block';
            previewVideo.style.display = 'none';
            $('#wonModal').modal('hide');
            if (previewVideoEl) {
                previewVideoEl.pause();
                previewVideoEl.currentTime = 0;
            }
        });

        closeModalBtn.addEventListener('click', () => {
            $('#wonModal').modal('hide');
            previewVideo.style.display = 'none';
            if (previewVideoEl) {
                previewVideoEl.pause();
                previewVideoEl.currentTime = 0;
            }
        });

        claimRewardBtn.addEventListener('click', () => {
            $('#wonModal').modal('hide');
            previewVideo.style.display = 'none';
            if (previewVideoEl) {
                previewVideoEl.pause();
                previewVideoEl.currentTime = 0;
            }
        });

        getRewardsVideo.addEventListener('click', () => {
            // Show the video preview
            previewVideo.style.display = 'block';
            if (previewVideoEl) {
                previewVideoEl.muted = false;
                previewVideoEl.play();
                previewVideoEl.addEventListener('ended', () => {
                    $('#wonModal').modal('show');
                });
            }
        });

        // Submit to server
        submitButton.addEventListener('click', async (event) => {
            event.preventDefault();

            submitButton.disabled = true;
            submitButton.textContent = 'Submitting...';
            responseDiv.innerHTML = '';

            const formData = new FormData(form);

            responseDiv.innerHTML = '<div class="text-secondary">Submitting...</div>';
            try {
                const response = await fetch(cloudFunctionUrl, {
                    method: 'POST',
                    body: formData,
                });

                const result = await response.json();

                if (response.ok) {
                    // Create a list of clickable links from the returned URLs
                    let urlListHtml = '<h5>✅ Success! Your campaign has been submitted. We’ll review it and get back to you shortly.</h5>';
                    responseDiv.innerHTML = urlListHtml;
                    submitButton.hide();
                } else {
                    responseDiv.innerHTML = `<p class="error">Error: ${result.error}</p>`;
                }

            } catch (error) {
                responseDiv.innerHTML = `<p class="error">A network error occurred: ${error.message}</p>`;
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Upload';
                form.reset();
            }
        });
    </script>
</body>
</html>
